<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<style>
body {
  font-family: Arial;
}
h1 {
  margin-bottom: 5px;
  margin-top: 5px;
}
button {
  vertical-align: top;
}
</style>
</head>
<body>
<div id="header">
  
  <img id="header_img" src="logo.png" style="padding-right: 10px; width: 70px; vertical-align: middle; float: left;"/>
  <h1>
  DropBox link:
  </h1>
  <h2 id="message">Loading...</h2>
  <a href="#" id="link" class='btn btn-primary btn-large' style="display: none;">Select File to Retrieve</a>
</div>

<script src="/jquery.min.js"></script>
<script>var lti = {tool_id: "dropbox"};</script>
<script src="/analytics.js"></script>
<script src="/lti.js"></script>
<script>
  $.getJSON('/dropbox_key', function(data) {
    var $script = $(document.createElement('script'));
    $script.attr('src', "https://www.dropbox.com/static/api/1/dropins.js");
    $script.attr('id', 'dropboxjs');
    $script.attr('data-app-key', data.key);
    document.body.appendChild($script[0]);
    $("#link").show();
    $("#message").hide();
  }).fail(function() { $("#message").text("Failure loading settings") });
  $(document).ready(function() {
    var file_allowed = lti.params.ext_content_intended_use == 'homework' && (lti.params.ext_content_return_types || "").match(/file/);
    var type = file_allowed ? "link" : "preview";
    $("#link").click(function(event) {
      event.preventDefault();
      Dropbox.choose({
        linkType: type,
        multiselect: false,
        success: function(files) {
          if(lti.params.ext_content_file_extensions) {
            var extensions = lti.params.ext_content_file_extensions.split(/,/);
            if(extensions.indexOf(files[0].name.split(/\./).pop()) == -1) {
              alert("That is not a valid file type for this submission");
              return;
            }
          }
          lti.resourceSelected({
            embed_type: (file_allowed ? "file" : "link"),
            url: files[0].link,
            title: files[0].name,
            text: files[0].name
           });
        }
      });
    });
  });
</script>
</body>
</html>

