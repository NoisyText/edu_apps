<?xml version="1.0" encoding="UTF-8"?>
<% app = @opts %>
  <cartridge_basiclti_link xmlns="http://www.imsglobal.org/xsd/imslticc_v1p0"
      xmlns:blti = "http://www.imsglobal.org/xsd/imsbasiclti_v1p0"
      xmlns:lticm ="http://www.imsglobal.org/xsd/imslticm_v1p0"
      xmlns:lticp ="http://www.imsglobal.org/xsd/imslticp_v1p0"
      xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation = "http://www.imsglobal.org/xsd/imslticc_v1p0 http://www.imsglobal.org/xsd/lti/ltiv1p0/imslticc_v1p0.xsd
      http://www.imsglobal.org/xsd/imsbasiclti_v1p0 http://www.imsglobal.org/xsd/lti/ltiv1p0/imsbasiclti_v1p0.xsd
      http://www.imsglobal.org/xsd/imslticm_v1p0 http://www.imsglobal.org/xsd/lti/ltiv1p0/imslticm_v1p0.xsd
      http://www.imsglobal.org/xsd/imslticp_v1p0 http://www.imsglobal.org/xsd/lti/ltiv1p0/imslticp_v1p0.xsd">
      <blti:title><%= CGI.escape_html(app['name'] || "") %></blti:title>
      <blti:description><%= CGI.escape_html(app['description'] || "") %></blti:description>
      <blti:icon><%= CGI.escape_html(app['icon_url'] || "") %></blti:icon>
      <% if app['launch_url'] %>
        <blti:launch_url><%= CGI.escape_html(app['launch_url'] || "") %></blti:launch_url>
      <% end %>
      <% if app['custom_fields'] %>
        <blti:custom>
          <% app['custom_fields'].each do |key, val| %>
            <lticm:property name="<%= key %>"><%= CGI.escape_html(val || "") %></lticm:property>
          <% end %>
        </blti:custom>
      <% end %>
      
      <blti:extensions platform="canvas.instructure.com">
        <lticm:property name="tool_id"><%= app['id'] %></lticm:property>
        <lticm:property name="privacy_level"><%= app['privacy_level'] %></lticm:property>
        <% if app['domain'] && !app['launch_url'] %>
          <lticm:property name="domain"><%= app['domain'] %></lticm:property>
        <% end %>
        <% if app['editor_button'] %>
          <lticm:options name="editor_button">
            <lticm:property name="url"><%= CGI.escape_html(app['editor_button']['launch_url'] || "") %></lticm:property>
            <% if app['editor_button']['icon_url'] %>
              <lticm:property name="icon_url"><%= CGI.escape_html(app['editor_button']['icon_url'] || "") %></lticm:property>
            <% end %>
            <lticm:property name="text"><%= CGI.escape_html(app['editor_button']['link_text'] || "") %></lticm:property>
            <lticm:property name="selection_width"><%= app['editor_button']['width'] %></lticm:property>
            <lticm:property name="selection_height"><%= app['editor_button']['height'] %></lticm:property>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
        <% if app['resource_selection'] %>
          <lticm:options name="resource_selection">
            <lticm:property name="url"><%= CGI.escape_html(app['resource_selection']['launch_url'] || "") %></lticm:property>
            <% if app['resource_selection']['icon_url'] %>
              <lticm:property name="icon_url"><%= CGI.escape_html(app['resource_selection']['icon_url'] || "") %></lticm:property>
            <% end %>
            <lticm:property name="text"><%= CGI.escape_html(app['resource_selection']['link_text'] || "") %></lticm:property>
            <lticm:property name="selection_width"><%= app['resource_selection']['width'] %></lticm:property>
            <lticm:property name="selection_height"><%= app['resource_selection']['height'] %></lticm:property>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
        <% if app['homework_submission'] %>
          <lticm:options name="homework_submission">
            <lticm:property name="url"><%= CGI.escape_html(app['homework_submission']['launch_url'] || "") %></lticm:property>
            <% if app['homework_submission']['icon_url'] %>
              <lticm:property name="icon_url"><%= CGI.escape_html(app['homework_submission']['icon_url'] || "") %></lticm:property>
            <% end %>
            <lticm:property name="text"><%= CGI.escape_html(app['homework_submission']['link_text'] || "") %></lticm:property>
            <lticm:property name="selection_width"><%= app['homework_submission']['width'] %></lticm:property>
            <lticm:property name="selection_height"><%= app['homework_submission']['height'] %></lticm:property>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
        <% if app['course_navigation'] %>
          <lticm:options name="course_navigation">
            <lticm:property name="url"><%= CGI.escape_html(app['course_navigation']['launch_url'] || "") %></lticm:property>
            <lticm:property name="text"><%= CGI.escape_html(app['course_navigation']['link_text'] || "") %></lticm:property>
            <% if app['course_navigation']['visibility'] %>
              <lticm:property name="visibility"><%= app['course_navigation']['visibility'] %></lticm:property>
            <% end %>
            <% if app['course_navigation']['default'] %>
              <lticm:property name="default"><%= app['course_navigation']['default'] %></lticm:property>
            <% end %>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
        <% if app['account_navigation'] %>
          <lticm:options name="account_navigation">
            <lticm:property name="url"><%= CGI.escape_html(app['account_navigation']['launch_url'] || "") %></lticm:property>
            <lticm:property name="text"><%= CGI.escape_html(app['account_navigation']['link_text'] || "") %></lticm:property>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
        <% if app['user_navigation'] %>
          <lticm:options name="user_navigation">
            <lticm:property name="url"><%= CGI.escape_html(app['user_navigation']['launch_url'] || "") %></lticm:property>
            <lticm:property name="text"><%= CGI.escape_html(app['user_navigation']['link_text'] || "") %></lticm:property>
            <lticm:property name="enabled">true</lticm:property>
          </lticm:options>
        <% end %>
      </blti:extensions>
      
      <cartridge_bundle identifierref="BLTI001_Bundle"/>
      <cartridge_icon identifierref="BLTI001_Icon"/>
  </cartridge_basiclti_link>  
